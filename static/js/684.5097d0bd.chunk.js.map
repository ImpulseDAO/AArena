{"version":3,"file":"static/js/684.5097d0bd.chunk.js","mappings":"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","sources":["app/api/characters.ts","components/Button/Button.tsx","hooks/useWatchArenaMessages/useWatchArenaMessages.ts","pages/MintCharacter/hooks/useWasmMetadata.ts","pages/StartFight/hooks/useOnSubmit.ts","pages/StartFight/components/StartFightView.tsx","pages/StartFight/StartFight.tsx"],"sourcesContent":["import { useAccount } from \"@gear-js/react-hooks\";\nimport { graphql } from \"gql/gql\";\nimport {\n  getGraphQLPrimaryKey,\n  useGraphQL,\n} from \"app/providers/ReactQuery/useGraphQL\";\nimport { UseQueryResult } from \"@tanstack/react-query\";\nimport { queryClient } from \"app/providers/ReactQuery\";\n\nconst allCharactersQueryDocument = graphql(/* GraphQL */ `\n  query AllCharacters {\n    characters {\n      id\n      level\n      name\n      owner\n      experience\n      attributes\n    }\n  }\n`);\n\nexport const useAllCharacters = () => useGraphQL(allCharactersQueryDocument);\n\nconst charactersByOwnerQueryDocument = graphql(/* GraphQL */ `\n  query CharactersByOwner($owner_eq: String!) {\n    characters(where: { owner_eq: $owner_eq }) {\n      id\n      level\n      name\n      owner\n      experience\n      attributes\n    }\n  }\n`);\n\nexport const resetUseMyCharacrersQuery = () => {\n  const primaryKey = getGraphQLPrimaryKey(charactersByOwnerQueryDocument);\n\n  queryClient.invalidateQueries({ queryKey: [primaryKey] });\n};\n\nexport const useMyCharacters = ({ owner_eq }: { owner_eq: string }) => {\n  return useGraphQL(charactersByOwnerQueryDocument, {\n    owner_eq,\n  });\n};\n\nexport const useMyCharacter = () => {\n  const { account } = useAccount();\n  const queryResult = useMyCharacters({\n    owner_eq: account?.decodedAddress ?? \"\",\n  });\n\n  const myCharacters = queryResult.data;\n\n  return {\n    ...queryResult,\n    data: myCharacters?.characters[\n      myCharacters?.characters.length - 1\n    ] as Character,\n  };\n};\n\nconst characterByIdQueryDocument = graphql(/* GraphQL */ `\n  query CharacterById($character_id: String!) {\n    characterById(id: $character_id) {\n      attributes\n      experience\n      id\n      level\n      name\n      owner\n    }\n  }\n`);\n\nexport const useCharacterById = ({ id }: { id: string }) => {\n  return useGraphQL(characterByIdQueryDocument, {\n    character_id: id,\n  }) as UseQueryResult<Character>;\n};\n","import React, {\n  ButtonHTMLAttributes,\n  DetailedHTMLProps,\n  FC,\n  ReactNode,\n} from \"react\";\nimport \"./styles.scss\";\nimport clsx from \"clsx\";\n\nexport type ButtonProps = {\n  onClick?: VoidFunction;\n  children: ReactNode;\n  disabled?: boolean;\n  value?: string;\n  buttonProps?: DetailedHTMLProps<\n    ButtonHTMLAttributes<HTMLButtonElement>,\n    HTMLButtonElement\n  >;\n  className?: string;\n};\n\nexport const Button: FC<ButtonProps> = ({\n  onClick,\n  children,\n  disabled,\n  buttonProps,\n  className,\n}) => {\n  const classes = clsx(\"button\", className, { disabled });\n  return (\n    <button\n      {...buttonProps}\n      className={classes}\n      onClick={onClick}\n      disabled={disabled}\n    >\n      {children}\n    </button>\n  );\n};\n","import { ProgramMetadata } from \"@gear-js/api\";\nimport { ARENA_METADATA, ARENA_PROGRAM_ID } from \"consts\";\nimport { useWatchMessages } from \"hooks/useWatchMessages/useWatchMessages\";\n\nexport const useWatchArenaMessages = <TReply>() => {\n  const arenaMetadata = ProgramMetadata.from(ARENA_METADATA);\n  const programId = ARENA_PROGRAM_ID;\n  return useWatchMessages<TReply>({\n    meta: arenaMetadata,\n    programId,\n  });\n};\n","import { useAlert } from \"@gear-js/react-hooks\";\nimport { useEffect, useState } from \"react\";\n\nexport const useWasmMetadata = (source: RequestInfo | URL) => {\n  const alert = useAlert();\n  const [data, setData] = useState<Buffer>();\n\n  useEffect(() => {\n    if (source) {\n      fetch(source)\n        .then((response) => response.arrayBuffer())\n        .then((array) => Buffer.from(array))\n        .then((buffer) => setData(buffer))\n        .catch(({ message }: Error) => alert.error(`Fetch error: ${message}`));\n    }\n  }, [alert, source]);\n\n  return { buffer: data };\n};\n","import { useCallback, useMemo } from \"react\";\nimport { ARENA_PROGRAM_ID, ARENA_METADATA } from \"consts\";\nimport { useAccount, useSendMessage } from \"@gear-js/react-hooks\";\nimport { ProgramMetadata } from \"@gear-js/api\";\nimport { MAX_GAS_LIMIT } from \"consts\";\nimport { useWatchArenaMessages } from \"hooks/useWatchArenaMessages/useWatchArenaMessages\";\nimport { useStableAlert } from \"hooks/useWatchMessages/useStableAlert\";\n\nexport const useOnRegisterForBattle = () => {\n  const { account } = useAccount();\n  const alert = useStableAlert();\n\n  const meta = useMemo(() => ProgramMetadata.from(ARENA_METADATA), []);\n  const send = useSendMessage(ARENA_PROGRAM_ID, meta, { isMaxGasLimit: true });\n\n  const { subscribe, unsubscribe } = useWatchArenaMessages<{\n    PlayerRegistered: {\n      lobbyId: \"32\";\n      playerId: \"9\";\n      tier: \"5\";\n    };\n  }>();\n\n  return useCallback(\n    async ({ lobbyId }: { lobbyId: string }) => {\n      return new Promise(async (resolve, reject) => {\n        subscribe((reply, error) => {\n          if (error) {\n            reject(error.message);\n            alert.error(error.message);\n            return;\n          }\n\n          reply != null &&\n            setTimeout(() => {\n              const { lobbyId, playerId, tier } = reply.PlayerRegistered;\n              const message = `Player ${playerId} registered for lobby ${lobbyId} with tier ${tier}`;\n              console.info(message);\n              alert.success(message);\n            });\n\n          resolve(reply);\n        });\n        const rejectAfterTimeout = () =>\n          setTimeout(\n            () => reject(new Error(\"Timeout: no reply from the arena\")),\n            4000\n          );\n        send({\n          payload: {\n            Register: {\n              owner_id: account?.decodedAddress,\n              lobby_id: lobbyId,\n            },\n          },\n          gasLimit: MAX_GAS_LIMIT,\n          onSuccess: () => {\n            console.log('\"Register\" message sent');\n            rejectAfterTimeout();\n          },\n          onError: () => {\n            console.log(\"Error while sending Register message\");\n            rejectAfterTimeout();\n          },\n        });\n      }).finally(() => {\n        unsubscribe();\n      });\n    },\n    [account?.decodedAddress, alert, send, subscribe, unsubscribe]\n  );\n};\n","import \"./styles.scss\";\nimport ArenaPng from \"assets/images/arena.png\";\nimport { FC, memo } from \"react\";\n\nimport { Button } from \"components/Button\";\n\nexport const colourOptions = [\n  { value: \"ocean\", label: \"Ocean\", color: \"#00B8D9\", isFixed: true },\n];\n\ntype StartFightViewProps = {\n  setUser: React.Dispatch<any>;\n  user: any;\n  name: string;\n  handleSubmit: VoidFunction;\n};\n\nexport const StartFightView: FC<StartFightViewProps> = memo(\n  ({ setUser, user, name, handleSubmit }) => {\n    return (\n      <div className=\"arena\">\n        <div className=\"arena_modal\">\n          <img className=\"arena_img\" src={ArenaPng} />\n          <p className=\"arena_title\">Enter the Arena</p>\n          {/* <div className=\"arena_select_wrapper\">\n            <p>Select your character</p>\n            <Select\n              className=\"arena_select\"\n              onClick={(user) => setUser(user)}\n              //@ts-ignore\n              icon={<img className=\"arena_user_icon\" src={userIcon} />}\n              //@ts-ignore\n              components={{ Control: SelectControl, Option: CustomOption }}\n              isSearchable\n              name=\"user\"\n              options={[\n                {\n                  value: name || localStorage.getItem(\"name\"),\n                  label: name || localStorage.getItem(\"name\"),\n                },\n              ]}\n              selectedUser={user}\n            />\n          </div> */}\n          <Button onClick={handleSubmit} disabled={!user}>\n            Start fight\n          </Button>\n        </div>\n      </div>\n    );\n  }\n);\n","import { memo, useState, useMemo, useEffect } from \"react\";\nimport { ProgramMetadata } from \"@gear-js/api\";\nimport { useOnRegisterForBattle } from \"./hooks/useOnSubmit\";\nimport { StartFightView } from \"./components/StartFightView\";\nimport { useAccount, useAlert, useReadWasmState } from \"@gear-js/react-hooks\";\nimport stateMetaWasm from \"../../assets/mint.opt.wasm\";\nimport { useWasmMetadata } from \"../MintCharacter/hooks/useWasmMetadata\";\nimport { ARENA_PROGRAM_ID, ARENA_METADATA, MINT_METADATA, MINT_PROGRAM_ID } from \"consts\";\nimport arenaMetaWasm from \"../../assets/arena.opt.wasm\";\nimport { useParams } from \"react-router-dom\";\nimport { useMyCharacter } from \"app/api/characters\";\n\nexport const colourOptions = [\n  { value: \"ocean\", label: \"Ocean\", color: \"#00B8D9\", isFixed: true },\n];\n\nexport const StartFight = memo(() => {\n  const alert = useAlert();\n  const { lobbyId } = useParams<{ lobbyId: string | undefined; }>();\n\n  /**\n   * Get user\n   */\n  const [user, setUser] = useState<typeof character>();\n  const { data: character } = useMyCharacter();\n  useEffect(() => {\n    if (character) {\n      setUser(character);\n    }\n\n  }, [character]);\n\n  const { account } = useAccount();\n  const { buffer } = useWasmMetadata(stateMetaWasm);\n  const { buffer: arenaMetaBuffer } = useWasmMetadata(arenaMetaWasm);\n\n  const meta = useMemo(() => ProgramMetadata.from(MINT_METADATA), []);\n  const arenaMeta = useMemo(() => ProgramMetadata.from(ARENA_METADATA), []);\n\n  const metaWasmData: MetaWasmDataType = useMemo(\n    () => ({\n      programId: MINT_PROGRAM_ID,\n      programMetadata: meta,\n      wasm: buffer,\n      functionName: \"character_info\",\n      argument: account?.decodedAddress,\n    }),\n    [account?.decodedAddress, meta, buffer]\n  );\n\n  const arenaMetaWasmData: MetaWasmDataType = useMemo(\n    () => ({\n      programId: ARENA_PROGRAM_ID,\n      programMetadata: arenaMeta,\n      wasm: arenaMetaBuffer,\n      functionName: \"registered\",\n      argument: account?.decodedAddress,\n    }),\n    [account?.decodedAddress, arenaMeta, arenaMetaBuffer]\n  );\n\n  const charInfo = useReadWasmState<{\n    id: string;\n    attributes: {\n      strength: string;\n      agility: string;\n      vitality: string;\n      stamina: string;\n    };\n    name: string;\n  }>(metaWasmData);\n\n  const registerForBattle = useOnRegisterForBattle();\n  const handleSubmit = () => {\n\n    if (!lobbyId) {\n      const message = \"lobbyId is not defined\";\n      console.error(message);\n      alert.error(message);\n      return;\n    }\n    console.log('registerForBattle called with lobbyId: ', lobbyId);\n    registerForBattle({ lobbyId });\n  };\n\n  return (\n    <StartFightView\n      name={charInfo?.state?.name ?? \"\"}\n      setUser={setUser}\n      user={user}\n      handleSubmit={handleSubmit}\n    />\n  );\n});\n"],"names":["graphql","charactersByOwnerQueryDocument","resetUseMyCharacrersQuery","primaryKey","getGraphQLPrimaryKey","queryClient","invalidateQueries","queryKey","useMyCharacters","_ref","owner_eq","useGraphQL","useMyCharacter","_account$decodedAddre","account","useAccount","queryResult","decodedAddress","myCharacters","data","characters","length","Button","onClick","children","disabled","buttonProps","className","classes","clsx","_jsx","useWatchArenaMessages","arenaMetadata","ProgramMetadata","from","ARENA_METADATA","programId","ARENA_PROGRAM_ID","useWatchMessages","meta","useWasmMetadata","source","alert","useAlert","setData","useState","useEffect","fetch","then","response","arrayBuffer","array","Buffer","buffer","catch","message","error","useOnRegisterForBattle","useStableAlert","useMemo","send","useSendMessage","isMaxGasLimit","subscribe","unsubscribe","useCallback","async","lobbyId","Promise","resolve","reject","reply","setTimeout","playerId","tier","PlayerRegistered","console","info","success","rejectAfterTimeout","Error","payload","Register","owner_id","lobby_id","gasLimit","MAX_GAS_LIMIT","onSuccess","log","onError","finally","StartFightView","memo","setUser","user","name","handleSubmit","_jsxs","src","ArenaPng","colourOptions","value","label","color","isFixed","StartFight","_charInfo$state$name","_charInfo$state","useParams","character","stateMetaWasm","arenaMetaBuffer","arenaMetaWasm","MINT_METADATA","arenaMeta","metaWasmData","MINT_PROGRAM_ID","programMetadata","wasm","functionName","argument","charInfo","useReadWasmState","registerForBattle","state"],"sourceRoot":""}