"use strict";(self.webpackChunkdapp=self.webpackChunkdapp||[]).push([[662],{2174:(e,r,n)=>{n.d(r,{L:()=>i,S9:()=>c,_H:()=>l,kw:()=>u});n(9664);var t=n(3051),s=n(6070);const a=(0,s.B)("\n  query BattleLogs {\n    battleLogs {\n      id\n      battleIndex\n      character1 {\n        winner\n        attributes\n        character\n        experience\n        rating\n        level\n      }\n      character2 {\n        winner\n        attributes\n        experience\n        character\n        level\n        rating\n      }\n      lobby {\n        id\n        characters {\n          id\n          character {\n            owner\n            name\n            level\n            experience\n            attributes\n            id\n          }\n        }\n        capacity\n      }\n      turns {\n        character1 {\n          energy\n          hp\n          position\n        }\n        logs {\n          action\n          character\n        }\n        character2 {\n          energy\n          position\n          hp\n        }\n      }\n    }\n  }\n"),l=()=>(0,t.a)(a,void 0,{select:e=>e.battleLogs}),o=(0,s.B)("\n  query BattleLogById($battleId: String!) {\n    battleLogById(id: $battleId) {\n      id\n      battleIndex\n      character1 {\n        winner\n        attributes\n        character\n        experience\n        rating\n        level\n      }\n      character2 {\n        winner\n        attributes\n        experience\n        character\n        level\n        rating\n      }\n      lobby {\n        id\n        characters {\n          id\n          character {\n            owner\n            name\n            level\n            experience\n            attributes\n            id\n          }\n        }\n        capacity\n      }\n      turns {\n        character1 {\n          energy\n          hp\n          position\n        }\n        logs {\n          action\n          character\n        }\n        character2 {\n          energy\n          position\n          hp\n        }\n      }\n    }\n  }\n"),i=e=>{let{battleId:r}=e;return(0,t.a)(o,{battleId:`${r}`},{enabled:null!=r,select:e=>e.battleLogById,placeholderData:e=>e})},d=(0,s.B)("\n  query BattleLogsByLobbyId($lobbyId: String!) {\n    battleLogs(where: { lobby: { id_eq: $lobbyId } }) {\n      id\n    }\n  }\n"),c=e=>{let{lobbyId:r}=e;return(0,t.a)(d,{lobbyId:`${r}`},{enabled:null!=r,select:e=>e.battleLogs})},u=(e,r)=>{var n;return null===(n=e.lobby.characters.find((e=>{let{character:{id:n}}=e;return n===r})))||void 0===n?void 0:n.character}},8311:(e,r,n)=>{n.d(r,{AX:()=>d,C7:()=>c,iV:()=>i});var t=n(3675),s=n(6070),a=n(3051),l=n(9664);(0,s.B)("\n  query AllCharacters {\n    characters {\n      id\n      level\n      name\n      owner\n      experience\n      attributes\n    }\n  }\n");const o=(0,s.B)("\n  query CharactersByOwner($owner_eq: String!) {\n    characters(where: { owner_eq: $owner_eq }) {\n      id\n      level\n      name\n      owner\n      experience\n      attributes\n    }\n  }\n"),i=()=>{const e=(0,a.P)(o);l.E.invalidateQueries({queryKey:[e]})},d=e=>{let{owner_eq:r}=e;return(0,a.a)(o,{owner_eq:r})},c=()=>{var e;const{account:r}=(0,t.mA)(),n=d({owner_eq:null!==(e=null===r||void 0===r?void 0:r.decodedAddress)&&void 0!==e?e:""}),s=n.data;return{...n,data:null===s||void 0===s?void 0:s.characters[(null===s||void 0===s?void 0:s.characters.length)-1]}};(0,s.B)("\n  query CharacterById($character_id: String!) {\n    characterById(id: $character_id) {\n      attributes\n      experience\n      id\n      level\n      name\n      owner\n    }\n  }\n")},6989:(e,r,n)=>{n.d(r,{J5:()=>c,fL:()=>b,m6:()=>h});var t=n(6070),s=n(3051),a=n(5875),l=n(6299),o=n(3675),i=n(139);const d=(0,t.B)("\n  query Lobbies {\n    lobbies {\n      id\n      capacity\n      tier\n      reservationsCount\n      characters {\n        id\n        character {\n          id\n          name\n          owner\n          level\n          experience\n          attributes\n        }\n      }\n      battleLogs {\n        id\n      }\n    }\n  }\n"),c=()=>(0,s.a)(d,void 0,{refetchInterval:3e3}),u=(0,t.B)("\n  query LobbyById2($id: String!) {\n    lobbyById(id: $id) {\n      id\n      capacity\n      tier\n      reservationsCount\n      characters {\n        id\n        character {\n          id\n          name\n          owner\n          level\n          experience\n          attributes\n        }\n      }\n      battleLogs {\n        id\n      }\n    }\n  }\n"),h=e=>{let{id:r}=e;return(0,s.a)(u,{id:`${r}`},{refetchInterval:3e3})},b=()=>{const e=(0,o.VY)(),r=(0,a.G)(),{isAccountReady:n}=(0,o.mA)(),{subscribe:t,unsubscribe:s}=(0,i.A)();return n?n=>{let{capacity:a}=n;return a<=0?(e.error("Capacity must be greater than 0"),Promise.reject("Capacity must be greater than 0")):new Promise(((n,s)=>{t(((r,t)=>{if(t)return s(t.message),void e.error(t.message);null!=r&&setTimeout((()=>{const{lobbyId:n,capacity:t}=r.LobbyCreated,s=`Lobby ${n} created with capacity ${t}`;console.info(s),e.success(s)})),n(r)})),r({payload:{CreateLobby:{capacity:`${a}`}},gasLimit:l.yQ,onSuccess:()=>{console.log("CreateLobby message successfully sent")},onError:()=>{console.log("Error while sending CreateLobby message"),s("Error while sending CreateLobby message")}})})).finally((()=>{console.log("Unsubscribing from arena messages"),s()}))}:e=>{let{capacity:r}=e;return Promise.resolve(void 0)}}},6880:(e,r,n)=>{n.d(r,{OY:()=>d,M:()=>c,OV:()=>u});var t=n(9702),s=n(6299),a=n(1313),l=n(5863),o=n(3675);var i=n(8311);const d=(0,l.r)({use:[e=>r=>{const{api:n}=(0,o.h_)();return e({...r,meta:{...r.meta,api:n}})}],queryKey:["mintProgramState"],fetcher:async(e,r)=>{var n;let{programId:s,metadata:a}=e;const l=t.Pj.from(a),o=null===(n=r.meta)||void 0===n?void 0:n.api,i=await(null===o||void 0===o?void 0:o.programState.read({programId:s,payload:void 0},l));return null===i||void 0===i?void 0:i.toJSON()}}),c=()=>{const e=(0,a.i)();return d({variables:{metadata:s.cV,programId:s.ZB},select:r=>{var n,t;return null!==(n=null===(t=r.characters)||void 0===t?void 0:t[null!==e&&void 0!==e?e:""])&&void 0!==n?n:null}})},u=()=>{var e;const r=null!==(e=(0,a.i)())&&void 0!==e?e:"",{data:n}=(0,i.AX)({owner_eq:r}),{data:t}=c();return{isDead:0!==(null===n||void 0===n?void 0:n.characters.length)&&!t,isFresh:0===(null===n||void 0===n?void 0:n.characters.length)}}},5875:(e,r,n)=>{n.d(r,{G:()=>i,c:()=>d});var t=n(9702),s=n(3675),a=n(6299),l=n(2791);const o={isMaxGasLimit:!0},i=()=>{const e=(0,l.useMemo)((()=>t.Pj.from(a.Rv)),[]),r=(0,s.$3)(a.mC,e,o);return(0,l.useCallback)(r,[])},d=()=>{const e=(0,l.useMemo)((()=>t.Pj.from(a.cV)),[]),r=(0,s.$3)(a.ZB,e,o);return(0,l.useCallback)(r,[])}},4869:(e,r,n)=>{n.d(r,{f:()=>o});var t=n(7065),s=n(2765),a=n(245),l=n(184);const o=e=>{let{gasNeeded:r,gasReserved:n,...a}=e;return(0,l.jsxs)(t.k,{align:"center",gap:"xs",...a,children:[(0,l.jsx)(t.k,{gap:2.75,children:Array.from({length:r}).map(((e,r)=>(0,l.jsx)(i,{filled:r<n},r)))}),(0,l.jsx)(s.x,{c:"white",fw:600,children:"Gas Reserved"})]})},i=e=>{let{filled:r}=e;return(0,l.jsx)(a.x,{bg:r?"primary":"white",w:20,h:8,style:{borderRadius:4}})}},1064:(e,r,n)=>{n.d(r,{s:()=>a});var t=n(4116),s=n(184);const a=e=>{let{children:r,turnOffPadding:n=!1,...a}=e;return(0,s.jsx)(t.X,{...n?{}:{p:"lg"},bg:"rgba(0, 0, 0, 0.7)",withBorder:!0,radius:12,style:{border:"2px solid #eaecf0",color:"white"},...a,children:r})}},5619:(e,r,n)=>{n.d(r,{k:()=>a});var t=n(8501),s=n(184);const a=e=>{let{children:r,onClick:n,...a}=e;return(0,s.jsx)(t.z,{onClick:n,radius:"sm",bg:"primary",size:"md",px:"xl",style:e=>({boxShadow:e.shadows.sm}),styles:e=>({root:{"&:disabled":{backgroundColor:e.colors.gray[5],color:e.colors.gray[6]}}}),...a,children:r})}},1313:(e,r,n)=>{n.d(r,{i:()=>s});var t=n(3675);const s=()=>{const{account:e}=(0,t.mA)();return null===e||void 0===e?void 0:e.decodedAddress}},139:(e,r,n)=>{n.d(r,{A:()=>l});var t=n(9702),s=n(6299),a=n(9712);const l=()=>{const e=t.Pj.from(s.Rv),r=s.mC;return(0,a.z)({meta:e,programId:r})}},1662:(e,r,n)=>{n.r(r),n.d(r,{Lobby:()=>W});var t=n(2791);const s=n.p+"static/media/progress.32123ade9716c5ec3561f8cd389547ec.svg";var a=n(7689),l=n(3675),o=n(9702),i=n(6299),d=n(8501),c=n(2765),u=n(5563),h=n(6880),b=n(184);const g=e=>{let{hasPlayerJoined:r,lobbyId:n,players:s,playersNeeded:g,refreshState:m,gasReservedTimes:v,onGasReserved:p,onStartButtonSucess:x}=e;const f=(0,l.VY)(),w=((0,a.s0)(),(0,t.useMemo)((()=>o.Pj.from(i.Rv)),[])),j=(0,l.$3)(i.mC,w,{isMaxGasLimit:!0}),C=4===g,{handleGasReserved:A}=y({onGasReserved:p}),{isDead:I,isFresh:N}=(0,h.OV)(),L=!I&&!r&&s.length<g,B=I||N,k=C&&v<2,S=!C||2===v,R=g===s.length&&S,[T,q]=t.useState(!1),P=r&&g>s.length,M=t.useCallback((()=>new Promise(((e,r)=>{j({payload:{ReserveGas:{lobby_id:n}},gasLimit:i.yQ,onSuccess:()=>{console.log("successfully reserved gas"),e("successfully reserved gas"),A()},onError:()=>{console.log("error while reserving gas"),r("error while reserving gas")}})}))),[j,n,A]),Y=t.useCallback((()=>new Promise((e=>{j({payload:{Play:{lobby_id:n}},gasLimit:i.yQ,onSuccess:()=>{localStorage.setItem("players",JSON.stringify([])),console.log("successfully started the battle"),e("successfully started the battle"),null===x||void 0===x||x()},onError:()=>console.log("error while starting the battle")})}))),[j,n,x]),F=(0,u.d)();return(0,b.jsxs)(b.Fragment,{children:[L?(0,b.jsx)(d.z,{className:["action_button",B&&"disabled"].filter(Boolean).join(" "),onClick:async()=>{if(r);else{if(!n){const e="lobbyId is not defined";return console.error(e),void f.error(e)}console.log("registerForBattle called with lobbyId: ",n);try{await F({lobbyId:n}),m()}catch(e){console.error(e)}finally{q(!1)}}},disabled:B,loading:T,children:"Join the battle"}):null,k?(0,b.jsx)(d.z,{className:["action_button"].filter(Boolean).join(" "),onClick:async()=>{q(!0);try{await M()}catch(e){console.error(e)}q(!1)},loading:T,children:"Reserve gas"}):null,R?(0,b.jsx)(d.z,{className:["action_button",P&&"disabled"].join(" "),onClick:async()=>{if(q(!0),!r){const e="You are not registered for the battle";return console.error(e),void f.error(e)}try{await Y()}finally{q(!1)}},loading:T,disabled:P,children:"Start battle"}):null,C&&r?(0,b.jsx)(c.x,{size:"xs",mt:3,children:`Gas reserved ${v} time(s)`}):null,null]})},y=e=>{let{onGasReserved:r}=e;const[n,s]=t.useState(0);t.useRef(r).current=r;return{gasReservedTimes:n,handleGasReserved:(0,t.useCallback)((()=>{s((e=>(null===r||void 0===r||r(e+1),e+1)))}),[r])}};var m=n(6989),v=n(4869),p=n(3901),x=n(7230),f=n(245),w=n(1313),j=n(6364),C=n.n(j);var A=n(5316);const I=A.ZP.div`
  display: flex;
  flex-direction: column;
  height: 100%;
  width: 100%;
  box-sizing: border-box;
  border-left: 2px solid white;
  border-right: 2px solid white;
  border-bottom: 2px solid white;
  border-bottom-left-radius: 12px;
  border-bottom-right-radius: 12px;

  overflow: hidden;
`,N=A.ZP.div`
  display: flex;
  align-items: center;
  height: 16px;
  gap: 4px;
  ${e=>{let{position:r}=e;return A.iv`
    justify-content: ${r};
  `}}
`,L=A.ZP.p`
  color: white;
  font-size: 12px;
  font-weight: ${e=>{let{active:r}=e;return r?"bold":"normal"}};
  padding-left: ${e=>{let{isLeftPadded:r}=e;return r?"1.5rem":""}};
`,B=A.ZP.div`
  display: flex;
  align-items: center;
  background: rgba(0, 0, 0, 0.7);
  height: 40px;
`,k=A.ZP.div`
  display: flex;
  flex-direction: column;
`,S={Container:I,Columns:B,Column:N,ColumnText:L,Row:A.ZP.div`
  height: 72px;
  display: flex;
  align-items: center;
  font-size: 14px;
  color: white;
  background: rgba(0, 0, 0, 0.7);
  border-top: 1px solid white;

  position: relative;

  &:last-child {
    border-bottom-left-radius: 12px;
    border-bottom-right-radius: 12px;
  }
`,Rows:k,Cell:A.ZP.div`
  display: flex;
  ${e=>{let{position:r}=e;return A.iv`
    justify-content: ${r};
  `}}

  cursor: ${e=>{let{ableClick:r}=e;return r?"pointer":"default"}};
`};let R=function(e){return e.ascending="ascending",e.descending="descending",e.default="default",e}({});const T=e=>{let{columns:r,rows:n,cellClick:s}=e;const[a,l]=(0,t.useState)({field:void 0,sortType:R.default}),o=(e=>{let{sortedColumn:r,rows:n}=e;const[s,a]=(0,t.useState)(n);return(0,t.useEffect)((()=>{const e=[...n],{field:t,sortName:s}=r;t&&(r.sortType===R.ascending&&e.sort(((e,r)=>{const n=s?"sortName":t,a=e[n].toUpperCase(),l=r[n].toUpperCase();return a>l?1:l>a?-1:0})),r.sortType===R.descending&&e.sort(((e,r)=>{const n=s?"sortName":t,a=e[n].toUpperCase(),l=r[n].toUpperCase();return a>l?-1:l>a?1:0}))),a(e)}),[n,r]),s})({rows:n,sortedColumn:a}),i=(e=>{let{columns:r,rows:n,cellClick:s}=e;return(0,t.useMemo)((()=>n.map(((e,n)=>{const t=r.reduce(((r,n,t)=>[...r,(0,b.jsx)(S.Cell,{position:n.position,style:{width:n.width},ableClick:!!s,children:(0,b.jsx)("div",{onClick:()=>null===s||void 0===s?void 0:s(e),children:e[n.field]})},t)]),[]);return(0,b.jsx)(S.Row,{children:t},n)}))),[s,r,n])})({columns:r,rows:o,cellClick:s}),d=(e=>(0,t.useCallback)((r=>()=>{const{field:n,sortable:t,sortName:s}=r;e((e=>{if(!t)return e;if(e.field===n){let r=e.sortType===R.ascending?R.descending:e.sortType===R.descending?R.default:R.ascending;return{field:n,sortType:r,sortName:s}}return{field:n,sortType:R.ascending,sortName:s}}))}),[e]))(l);return(0,b.jsxs)(S.Container,{children:[(0,b.jsx)(S.Columns,{children:r.map(((e,r)=>{var n;return(0,b.jsx)(S.Column,{position:e.position,style:{width:e.width},onClick:d(e),children:(0,b.jsx)(S.ColumnText,{active:a.sortType!==R.default&&a.field===e.field,sortable:null!==(n=e.sortable)&&void 0!==n&&n,isLeftPadded:0===r,children:e.headerName})},e.field)}))}),(0,b.jsx)(S.Rows,{children:i})]})};var q=n(5850),P=n(2174),M=n(7065);const Y=[{field:"id",headerName:"Player ID",width:220},{field:"NB",headerName:"Number of battles",width:144,position:"center"},{field:"level",headerName:"Level",width:172,position:"center"}],F=e=>{let{characters:r}=e;return(0,b.jsx)(z,{children:e=>(0,b.jsx)(V,{characters:r,battleLogs:e})})},z=e=>{let{children:r}=e;const{data:n}=(0,P._H)();return r(n)},V=e=>{let{characters:r,battleLogs:n}=e;const s=(0,t.useMemo)((()=>!r||C()(Object.values(r))?[{name:"",id:"",NB:(0,b.jsx)(M.k,{align:"center",justify:"center",style:{position:"absolute",left:0,right:0,bottom:0,top:0},children:"Lobby is empty"}),level:"",isMyCharacter:!1}]:r.map((e=>{var r;let{name:t,id:s,level:a,isMyCharacter:l}=e;return{name:t,id:(0,b.jsx)(G,{name:t,id:(0,q.f5)(s),isSelected:l}),NB:null!==(r=null===n||void 0===n?void 0:n.filter((e=>{let{character1:r,character2:n}=e;return r.character===s||n.character===s})).length)&&void 0!==r?r:0,level:(0,b.jsxs)("span",{className:"row_lvl",children:[a," LVL"]}),isMyCharacter:l}}))),[n,r]);return(0,b.jsx)(T,{rows:s,columns:Y})},G=e=>{let{name:r,id:n,isSelected:t}=e;return(0,b.jsxs)("div",{className:"row_player",children:[(0,b.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAhCSURBVHgBtVlLcxxnFT3d09MzPe/RzEgey7JGid9KEQU/iKFiTAUKs0pYsMZUsfAKzI6ds2SX8AuABWyBYpUNyAvABVWUHXASx7IsyYqt17xn+v3gfK1RylIkT49jX+tWz3R193fm3O/ee25bwvPbZfoc/duDY2Hgwlr0pYHfoc8P/KWbAHCD3qQHI/pD+m/oNbwEE8Defw5QB/kLBfpzPB9jURi9iq9oL5K1g/z9ZwGQDjgvQvpHbCfCcONT8qkErr19HDkpwF8W+rh1dwkj2G36d7CdXLssdsAN/6S/iSGWTCZRyWfxzdk5TCoSakEbeVVCYHhYNSSMF4rIpVNo9/vDHnVosN7vogAUlL+LIZaIx/HOpUsElEKr1YHsGsjLFkEnsN62YaslHCmVUNQ0rLVacD1v2CNr2I7ch0+flPdcdJV+HRHs/OkzWF1+DNd14fOfzDC/fWES3/9eDWosgGGY8DwflhtgujKBmCRFeex17Flf3vMLbmCIiXVOTU/DNRy09T7qZM9yXJSTPtKwofLz9FgcckxCp6+j0W4jq6Vx7uQZqEocEUxgKOwH8AYi1KbTMzOA5XPxHlrdTsiex/C5PhMykOC5gjW67cCwrXD/Nbtd9Ht9FFNp/kB52BI7zWAXwBoi1qQ4U9ZyucdcByktha5uwLZt6GTOMj04ToCe6fDoQDdNsqaEn02L18eTSCixKMtcHwD9AuDQ0O5Yu6dDiSmEyWwVrNFs14PvS9AFcz5guIAfBDznQSFAJRbjkex6LrwgiLrU9acBXo54Ex5tbZANAyXVxbmqih99LYWJvIqpsoZkIY2GF0dtLEm2VFyZzePiYQlHMwEkx0TT1OEwqSKa6GBhmbmMiJkr7NVDZcyqOrK+hbJqo5JWcfFoChocVHIaDpUS6LdNvFpWMCY5CJhIFvfgeFIUcxXLHSPqUrwDN2WMwJ6wgCyIrLUZLpdlBNyLCkNZyMbRY2bfv1/nz44hG9iQyJYs2gz/WrrOa22MaHMC4Ouj3GGyrolMTahxfGZk8Kjlo5hTUcolUG93w4RxfIdhl9GxAnzcjsFRtLAO2pAxol0WIf4ltltNJEvKASY1GflCHp8S3N2Gg3+vGMiOFXBqdgJTp2vca8Dv/7GFDx/q2LKArKpiTPWwZfp4ojsYwZKivAspVYh6Ry2v4Y1cgEqpAunQFPqmhOXNLTxc3cRMSWOy5HDz48fQ0gl8ffYEttht8nEfpaCBhb6M+dUWRrCWMgo4YeNJmSH2cOb0FM7OnsLyehOfb2bxKQH94NwMJo8dRfIP86hVK5gup+AdymCl1Uan5SFnNLlX0yzwfUS0ggjxe1GvVtgFLk4Wwvq31eigu+VgZjyNE7NHkbEsKLKP8uE85JaO12arUBJx1J808K8HK3DYeXTDhqdq2OxFzmQIBgXnkVh0Az88qoqMzzo+N30TMVnGKwREHYOiGqNQALRkCg8WNqDx6beX6/jvuo7zZSYWs3t1ffQQRwYorM4sPsOS0klkIDOTO2xrSi6DRe61+Tt1HF9YxwOye+XsDJYX22BeYIyasFxw0ZF1dFZ9jGBLIu9vR71aKBmRwWPFNBzWQVVLwmbbq1sm3pqr4tybJ3G32cW7330NT5oGTN4QS6rI51OYrBaR5+fpUgYj2LIAeDPq1UdyFAd1Ek5QjY7JvuuhTUbXNkwsLJow2UG+cewIFu41sFnXsWlY6LCQmyzssXQWjxjes1NljGC3RYgjMzhX0XB8PAObzPS4aM+02UioXjQVK4+bYa8NKAZcO2C5yVPhUN1QG2w2uqh3s6hOVcOePJ5LY6MTKZPnBYPz2GdY2WuXTkzB6XVxe3EdxfExlhoJ91fXmSgeNihMJ45kce3H5/Gzn17EW9+ahkVtalIrrqxt8Vq2vKTCctTBJ6sNvHNmAnlGY4gtCWw74kzDM3pyhslwdlyjDvQgUxUv1bnh+y7iioq1RgsTlRwOV5IMdQf3FuuU/wEafQf3lta4V30c4Z7931Idp6saVII2mViFTAaftw14/oFJ8yf6n3cGBZHFzf2uyqU0zBTz7BZ19KicNe6/iVQ2DNPc8Qn89T9LkOOUVNUS4kIXiMRgrVknW+sM7YVTU2yPPv7+yWP2cYf7Uqcm9FFJpfhDqCpZeh5zLHD9L+nEGcGiMvgiQvxrDDTYjiU5uY0nVDxiYhS0BCTL5qQdC/eZmIMrBHn86BjuLDzBR/dXQyErxKlEAH3bRDmTwoWTVdy6s8jz1DWUgoocQ5qqumUYoegVf1/Ght9iO8S7xs5b9GvY1mGhCfp1zhZiYBQSK6vFYTg+C7CC2ekK4nFqvnQcD58I8n0WaSXsNq7vhupl7lgVVKjI8Yc02jrWqcZ9gpek7WlPzCdGOBXuMgHsJwPSdgE0BQ76laevdoV051Fmx4iTnfAbWZiiejbIaJfqROKea/bMcHHXcyiqZHYbCa9MFFmoZfg8t9HqYYVyTHSanu2F7FmspfsMAL/AU6/q9k4wgsUi9rxVCEsH2bS5BxMcJ9ssLxaHIJfsNtlXZS7T43eZjIhrRdjK2WQIots3OCZ08NEahWzgwWTSOHyWu/9sIrbZr54+cdA0/TcckNViQFdjIowSJtgZMsr2I2IMb98Jwm4j9mA5o/Eaj6F0sdrj1BfOIv5+ybBjoh6/sffks14eCZBzeIaJjM0QrGA1ToBicZ/sxJkEfsi4D4OsW/7QSW6e/kNEqMd77QO8/NdvH+Ar2lVsv2x80cBE6keeJodZDdu16UWyNpKSHxXo8zAqGHtvVGCR3okdYJcH/voAeA27/xtCuMjMm4PjPJ7D/g+aqR86fCzjIAAAAABJRU5ErkJggg==",alt:"AvatarIcon",className:""+(t?"selected_image":"")}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"row_name",children:r}),(0,b.jsx)("p",{children:n})]})]})};var O=n(5619),U=n(9032),D=n(5596),E=n(1064);const H=e=>{const r=(0,a.s0)(),{isDead:n,isFresh:t}=(0,h.OV)();return n||t?(0,b.jsx)(f.x,{...e,children:(0,b.jsx)(E.s,{p:"md",maw:"20rem",children:(0,b.jsxs)(c.x,{fz:14,fw:"500",ta:"center",children:[n?(0,b.jsxs)(b.Fragment,{children:["Unfortunately, you cannot participate in battles, because your character is ",(0,b.jsx)(c.x,{component:"span",c:"redHealth",fz:14,children:"dead"}),"."]}):"You cannot participate in battles, because you don't have any character yet.",(0,b.jsx)("br",{}),(0,b.jsx)(D.e,{fw:"500",onClick:()=>r(U._.mintCharacter),fz:14,children:"Click here to create a character"})]})})}):null};var Q=n(4373);const W=()=>{var e,r,n;const l=(0,a.s0)(),o=(0,w.i)(),{lobbyId:d}=(0,a.UO)(),{data:u,refetch:h}=(0,m.m6)({id:null!==d&&void 0!==d?d:""}),y=null===u||void 0===u?void 0:u.lobbyById,f=null===y||void 0===y?void 0:y.characters,j=0!==(null===y||void 0===y||null===(e=y.battleLogs)||void 0===e?void 0:e.length),C=null!==(r=null===y||void 0===y?void 0:y.reservationsCount)&&void 0!==r?r:0,{characters:A,hasPlayerJoined:I}=(0,t.useMemo)((()=>{var e;if(!f)return{characters:[],hasPlayerJoined:!1};let r=!1;return{characters:null!==(e=f.map((e=>{var n;const t=e.character.owner===o;return r=r||t,{isMyCharacter:t,playerId:e.id,id:e.character.id,name:e.character.name,level:null!==(n=e.character.level)&&void 0!==n?n:0}})))&&void 0!==e?e:[],hasPlayerJoined:r}}),[o,f]),N=A.length,L=null===y||void 0===y?void 0:y.capacity,B=N===(null!==L&&void 0!==L?L:0),k=null!==(n=i.DP[null!==L&&void 0!==L?L:0])&&void 0!==n?n:0,S=`Tier ${String(null===y||void 0===y?void 0:y.tier)}`,R=(0,Q.a)("(min-width: 1200px)");return(0,b.jsx)("div",{className:"lobby_content_wrapper",children:(0,b.jsxs)("div",{className:"modal_queue",children:[(0,b.jsx)(H,{mb:"lg",style:R?{position:"absolute",left:"2rem"}:{}}),(0,b.jsxs)("div",{className:"modal_loader",children:[(0,b.jsx)("p",{className:"modal_tille",children:"Tournament participants"}),(0,b.jsxs)(p.K,{align:"center",pos:"relative",w:"100%",children:[(0,b.jsx)(J,{lobbyId:d,tierText:S}),B?j?(0,b.jsx)(c.x,{className:"modal_info",color:"red",children:"Lobby ended"}):(0,b.jsx)("p",{className:"modal_info",children:"Ready to start"}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("img",{className:"modal_progress",src:s,alt:"ProgressIcon"}),(0,b.jsx)("p",{className:"modal_info",children:"Waiting players"})]})]}),(0,b.jsxs)(x.C,{c:"white",style:{textTransform:"none"},mb:"lg",children:[N," of ",L," players"]}),0!==k?(0,b.jsx)(v.f,{mt:"auto",mb:"xs",gasNeeded:k,gasReserved:C}):null]}),(0,b.jsx)("div",{className:"modal_table",children:(0,b.jsx)(F,{characters:A,hasPlayerJoined:I})}),null==f||j?null:(0,b.jsx)(g,{hasPlayerJoined:I,players:f,playersNeeded:null!==L&&void 0!==L?L:0,gasReservedTimes:C,lobbyId:d,refreshState:()=>{console.log("refreshState"),h()},onGasReserved:e=>{},onStartButtonSucess:()=>{setTimeout((()=>{h(),l(U.F.tournamentResult({lobbyId:null!==d&&void 0!==d?d:""}))}),3e3)}}),j?(0,b.jsx)(O.k,{mt:"lg",w:200,onClick:()=>d&&l(U.F.tournamentResult({lobbyId:d})),children:"See results"}):null]})})},J=e=>{let{lobbyId:r,tierText:n}=e;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.x,{pos:"absolute",top:10,right:15,children:(0,b.jsxs)(c.x,{fz:12,fw:"600",color:"white",bg:"rgba(0, 0, 0, 0.4)",py:4,px:8,style:{borderRadius:9999},children:["Lobby ID #",r]})}),n&&""!==n?(0,b.jsx)(f.x,{pos:"absolute",top:10,left:15,children:(0,b.jsx)(c.x,{fz:12,fw:"600",color:"white",bg:"rgba(0, 0, 0, 0.4)",py:4,px:8,style:{borderRadius:9999},children:n})}):null]})}},5563:(e,r,n)=>{n.d(r,{d:()=>d});var t=n(2791),s=n(6299),a=n(3675),l=n(9702),o=n(139),i=n(3477);const d=()=>{const{account:e}=(0,a.mA)(),r=(0,i.t)(),n=(0,t.useMemo)((()=>l.Pj.from(s.Rv)),[]),d=(0,a.$3)(s.mC,n,{isMaxGasLimit:!0}),{subscribe:c,unsubscribe:u}=(0,o.A)();return(0,t.useCallback)((async n=>{let{lobbyId:t}=n;return new Promise((async(n,a)=>{c(((e,t)=>{if(t)return a(t.message),void r.error(t.message);null!=e&&setTimeout((()=>{var n;const{lobbyId:t,playerId:s,tier:a}=null!==(n=e.PlayerRegistered)&&void 0!==n?n:{},l=`Player ${s} registered for lobby ${t} with tier ${a}`;console.info(l),r.success(l)})),n(e)}));const l=()=>setTimeout((()=>a(new Error("Timeout: no reply from the arena"))),4e3);d({payload:{Register:{owner_id:null===e||void 0===e?void 0:e.decodedAddress,lobby_id:t}},gasLimit:s.yQ,onSuccess:()=>{console.log('"Register" message sent'),l()},onError:()=>{console.log("Error while sending Register message"),l()}})})).finally((()=>{u()}))}),[null===e||void 0===e?void 0:e.decodedAddress,r,d,c,u])}}}]);
//# sourceMappingURL=662.8ab0e286.chunk.js.map